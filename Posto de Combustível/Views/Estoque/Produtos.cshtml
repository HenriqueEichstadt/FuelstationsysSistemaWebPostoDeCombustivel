<title>Lista de produtos</title>
<div class="main-content">
    <div class="content-heading clearfix">
        <div class="heading-left">
            <h1 class="page-title">Estoque</h1>
            <p class="page-subtitle">Lista de produtos</p>
        </div>
        <ul class="breadcrumb">
            <li><a href="#"><i class="fa fa-home"></i> Home</a></li>
            <li><a href="#">Estoque</a></li>
            <li><a href="#">Lista de produtos</a></li>
        </ul>
    </div>

    <div class="panel">
        <div class="panel-heading">
            <h3 class="panel-title">Cadastro de produtos</h3>
        </div>
        <div class="panel-body text-center">

            <div>
                <button type="button" class="btn btn-success btn-lg" onclick="window.location.href='/Estoque/Form'">Adicionar</button>
                <button type="button" class="btn btn-info btn-lg" id="editar">Editar</button>
                <button type="button" class="btn btn-danger btn-lg" onclick="" id="excluir">Deletar</button>
            </div>

            <table id="MyEstoque" class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Nome</th>
                        <th>Marca</th>
                        <th>Categoria</th>
                        <th>Preço de Venda</th>
                        <th>Preço de Custo</th>
                        <th>Estoque atual</th>
                        <th>Limite de estoque</th>
                        <th>Validade</th>
                        <th>Troca por pontos</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>

@section body_scripts{

    <script>
        $(document).ready(function () {
            var tabela = $('#MyEstoque').DataTable({
                dom: 'Blftip',
                select: { style: 'single' },
                "language":
                {
                    "info": "Total: _TOTAL_ marcas(s) - Página _PAGE_ de _PAGES_.",
                    "zeroRecords": "Nenhum resultado encontrado.",
                    "infoEmpty": "Mostrando 0 marcas.",
                    "infoFiltered": "(Filtrado de _MAX_ itens.)",
                    "decimal": ",",
                    "thousands": ".",
                    "search": "",
                    "loadingRecords": "Carregando...",
                    "processing": "Processando...",
                    "paginate": {
                        "first": "Primeira",
                        "last": "Última",
                        "next": "Próxima",
                        "previous": "Anterior"
                    },
                    "lengthMenu": "Marcas por página:  _MENU_",
                    select: {
                        rows: {
                            _: "%d marcas selecionadas.",
                            0: "Clique em uma marca para selecioná-la.",
                            1: "1 marca selecionada."
                        }
                    }
                },
                "ajax": {
                    "url": "/Estoque/ListaProdutos",
                    "type": "GET",
                    "datatype": "json",
                    "dom": 'Bfrtip',
                    "buttons": [
                        'Adicionar', 'Alterar', 'Excluir'
                    ],
                },
                "columns": [
                    { "data": "Id", "autoWidth": true, },
                    { "data": "Nome", "autoWidth": true },
                    {
                        "data": "Marca",
                        "autoWidth": true,
                        render: function (data, type, row) {
                            if (row.Marca == null) {
                                return "Sem Marca";
                            }
                            else {
                                return data;
                            }
                        }
                    },
                    {
                        "data": "Categoria",
                        "autoWidth": true,
                        render: function (data, type, row) {
                            if (row.Categoria == 'C') {
                                return "Combustível";
                            }
                            else {
                                return "Produto";
                            }
                        }
                    },
                    { "data": "PrecoVenda", "autoWidth": true },
                    { "data": "PrecoCusto", "autoWidth": true },
                    { "data": "EstoqueAtual", "autoWidth": true },
                    {
                        "data": "LimiteEstoque",
                        "autoWidth": true,
                        render: function (data, type, row) {
                            if (row.LimiteEstoque == null) {
                                return "Sem Limite";
                            }
                            else {
                                return data;
                            }
                        }
                    },
                    {
                        "data": "Validade", "autoWidth": true,
                        render: function (data, row) {
                            return moment(row.Validade).format("DD/MM/YYYY");
                        }
                    },
                    {
                        "data": "TrocaPontosFidelidade", "autoWidth": true,
                        render: function (data, type, row) {
                            if (row.TrocaPontosFidelidade == null) {
                                return "0";
                            }
                            else {
                                return data;
                            }
                        }
                    }
                ],
            });

            // Inativa produto no banco de dados e da DataTable
            $('#excluir').click(function () {
                var ProdutoId = tabela.rows({ selected: true }).data()[0].Id;
                $.ajax({
                    type: "GET",
                    url: "/Estoque/InativaProduto/" + ProdutoId,
                    dataType: "json",
                    success: function (response) {
                        if (response.inativou) {
                            alert("Produto apagado.");
                            tabela.ajax.reload();
                        }
                    }
                });
            });

            // envia id para controler
            $('#editar').click(function () {
                var ProdutoId = tabela.rows({ selected: true }).data()[0].Id;
                window.location.href = "/Estoque/UpdateForm/" + ProdutoId
            });

        });
    </script>
}

