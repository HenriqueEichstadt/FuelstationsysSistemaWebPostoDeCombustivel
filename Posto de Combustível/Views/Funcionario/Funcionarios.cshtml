<title>Lista de funcionários</title>

<div class="main-content text-center">
    <div class="content-heading clearfix">
        <div class="heading-left">
            <h1 class="page-title">Cadastros</h1>
            <p class="page-subtitle">Lista de funcionários</p>
        </div>
        <ul class="breadcrumb">
            <li><a href="#"><i class="fa fa-home"></i> Home</a></li>
            <li><a href="#">Cadastros</a></li>
            <li><a href="#">Lista de funcionários</a></li>
        </ul>
    </div>

    <div class="panel demo display">
        <div class="panel-heading">
            <h3 class="panel-title">Funcionários</h3>
        </div>
        <div class="panel-body">



            <div>
                <button type="button" class="btn btn-success btn-lg" onclick="window.location.href='/Funcionario/Form'">Adicionar</button>
                <button type="button" class="btn btn-info btn-lg" id="editar">Editar</button>
                <button type="button" class="btn btn-danger btn-lg" onclick="" id="excluir">Deletar</button>
            </div>

            <table id="MyEstoque" class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Nome de Usuario</th>
                        <th>Cargo</th>
                        <th>Registro de pessoa</th>
                        <th>Nivel de Acesso</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>

@section body_scripts{

    <script>

        // Popula a data Tables
        $(document).ready(function () {
            var tabela = $('#MyEstoque').DataTable({
                dom: 'Blftip',
                select: true,
                "ajax": {
                    "url": "/Funcionario/ListaFuncionarios",
                    "type": "GET",
                    "datatype": "json",
                },
                "columns": [
                    { "data": "Id", "autoWidth": true, },
                    { "data": "NomeUsuario", "autoWidth": true },
                    { "data": "Cargo", "autoWidth": true },
                    { "data": "Pessoa.Nome", "autoWidth": true },
                    {
                        "data": "NivelAcesso",
                        "autoWidth": true,
                        render: function (data, type, row) {
                            if (row.NivelAcesso == 0) {
                                return "Administrador";
                            }
                            else {
                                return "Funcionario";
                            }
                        }
                    }
                ]
            });

            // Exclui Funcionario do banco de dados e da DataTable
            $('#excluir').click(function () {
                var funcionarioId = tabela.rows({ selected: true }).data()[0].Id;
                $.ajax({
                    type: "GET",
                    url: "/Funcionario/DeletaFuncionario/" + funcionarioId,
                    dataType: "json",
                    success: function (response) {
                        if (response.deletou) {
                            alert("Funcionário apagado!");
                            tabela.ajax.reload();
                        }
                    }
                });
            });



            function AlteraCadastro() {
                $.ajax({
                    type: "POST",
                    url: "/Funcionario/ModificaFuncionarios",
                    data: { Atualiza: $("#listaFuncionarios").val() },
                    dataType: 'json',
                    contentType: "application/json; charset=utf-8",
                });
            }

            // envia id para controler
            $('#editar').click(function () {
                var FuncionarioId = tabela.rows({ selected: true }).data()[0].Id;
                window.location.href = "/Funcionario/UpdateForm/" + FuncionarioId
            });
        });

    </script>
}
