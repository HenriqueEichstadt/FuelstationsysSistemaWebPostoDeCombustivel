<div class="main-content">
    <div class="content-heading clearfix">
        <div class="heading-left">
            <h1 class="page-title">Menu</h1>
            <p class="page-subtitle">Venda</p>
        </div>
        <ul class="breadcrumb">
            <li><a href="#"><i class="fa fa-home"></i> Home</a></li>
            <li><a href="#">Venda</a></li>
        </ul>
    </div>


    <form action="/Venda/EmitirVenda" id="FormCadastro" method="post">
        <div class="form-horizontal">
            <div class="panel-body" id="formCadastro">
                <div class="col-md-12">
                    <!-- Select para Forma de Pagamento-->
                    <div class="col-md-4 margin-top-15">
                        <div class="input-group">
                            <span class="input-group-addon">Forma de Pagamento</span>
                            <select id="formaDePagamento" name="formaDePagamento" class="form-control" style="text-align-last:center;" type="text">
                                <option>Selecione uma forma de pagamento</option>
                                <option value="0">Dinheiro</option>
                                <option value="1">Débito</option>
                                <option value="2">Crédito</option>
                                <option value="4">Troca por pontos</option>
                            </select>
                        </div>
                    </div>
                    <!-- Select para Cliente-->
                    <div class="col-md-8 margin-top-15">
                        <div class="input-group">
                            <span class="input-group-addon">Cliente</span>
                            <select id="selectClientes" name="cliente" class="form-control" style="text-align-last:center;" placeholder="" type="text">
                                <option></option>
                            </select>
                        </div>
                    </div>
                    <!-- Select para Buscar Produtos do banco-->
                    <div class="">
                        <div class="col-md-6">
                            <div class="input-group margin-top-15">
                                <span class="input-group-addon">Seleciona um Produto</span>
                                <select id="selectProdutos" onclick="" name="cliente" class="form-control" style="text-align-last:center;" placeholder="" type="text">
                                    <option></option>
                                </select>
                            </div>
                        </div>
                        <!-- Input para Quantidade-->
                        <div class="col-md-2">
                            <div class="input-group margin-top-15">
                                <span class="input-group-addon">Quantidade</span>
                                <input id="quantidade" name="" class="form-control" placeholder="" type="number">
                            </div>
                        </div>
                        <!-- Input para Valor do produto-->
                        <div class="col-md-2">
                            <div class="input-group margin-top-15">
                                <span class="input-group-addon">Valor</span>
                                <input id="valor" name="" class="form-control" placeholder="" type="number">
                            </div>


                        </div>
                        <div class="col-md-2 margin-top-15 text-right">
                            <button id="botaoFinalizar" onclick="gravarNaTabela()" type="button" class="btn btn-success">Adicionar</button>
                        </div>
                    </div>
                </div>

                <!-- Tabela de produtos a serem vendidos -->
                <div id="tabelaVenda" class="col-md-12 lightseagreen text-center" style="height: 300px; text-align:center;   ">

                    <table id="MyTable" class="table table-striped table-hover text-center" style="position: relative; top:20px">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Produto</th>
                                <th>Valor</th>
                                <th>Quantidade</th>
                                <th>Subtotal</th>
                                <th>Remover</th>
                            </tr>
                        </thead>
                        <tr></tr>
                    </table>
                </div>

                <div class="form-group">
                    <!-- input para valor total de Pagamento -->
                    <div class="col-md-5 floatRigth margin-top-15" style="position: relative; left: 150px; top: 300px;">
                        <div class="input-group">
                            <span class="input-group-addon">Total a pagar</span>
                            <input id="totalAPagar" value="" form-control" style="text-align-last:center;" placeholder="" type="text">

                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-6 control-label" for="Cadastrar"></label>
                    <div class="col-md-12" style="position: relative; left: 925px; top: 30px;">
                        <button id="botaoFinalizar" name="Cadastrar" class="btn btn-success" type="Submit">Finalizar</button>
                        <button id="botaoCancelar" name="Cancelar" class="btn btn-danger" type="Reset">Cancelar</button>
                    </div>
                    <fieldset id=""></fieldset>
                </div>
            </div>

        </div>
    </form>
</div>


@section body_scripts{
    <script src="~/Content/javascript/Venda.js"></script>

    <script type="text/javascript">



        var arrayDeVendaEstoque = [];
        $("#botaoFinalizar").click(function () {
            // Varrendo todos os itens inseridos (olha a vassoura!)
            $('.item').each(function () {
                // Montando objeto que possui as mesmas propriedades do objeto C# do Controller.
                var array_venda = {
                    Produto: $(this).children()[0].innerText,
                    Unidades: $(this).children()[1].innerText,
                    Valor: $(this).children()[2].innerText,
                    EstoqueId: $(this).children()[3].innerText,
                    PrecoTotalItem: $(this).children()[4].innerText,
                };

                // Adicionando objeto a lista.
                arrayDeVendaEstoque.push(array_venda);
            });
        });

       

        $("#botaoFinalizar").click(function (event) {
            event.preventDefault();
            var venda = {
                ClienteId: $("#selectClientes").val(),
                Unidades: $("#clienteVenda").val(),
                FormaDePagamento: $("#formaDePagamento").val(),
                PrecoTotal: $("#totalAPagar").val(),
            };
            $.ajax({
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                type: 'POST',
                url: '/Venda/EmitirVenda',
                data: JSON.stringify({ venda: venda, arrayDeVendaEstoque: arrayDeVendaEstoque }),
                success: function (response) {
                    console.log(response);
                }
            });
        });

       

      
    </script>
}
